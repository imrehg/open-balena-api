# Change Log

All notable changes to this project will be documented in this file
automatically by Versionist. DO NOT EDIT THIS FILE MANUALLY!
This project adheres to [Semantic Versioning](http://semver.org/).

## 0.29.0 - 2019-07-17

* ðŸ’¥ðŸ—ƒ : Add device types table and link it [Andreas Fitzek]

## 0.28.2 - 2019-07-09

* Fix key comparison [Pagan Gazzard]

## 0.28.1 - 2019-07-08

* Use a prepared query for `gracefullyDenyDeletedDevices` middleware [Pagan Gazzard]
* Use a prepared query for `getUser` helper [Pagan Gazzard]
* Use a prepared query for vpn auth requests [Pagan Gazzard]

## 0.28.0 - 2019-07-08


<details>
<summary> Update open-balena-base to 8.0.0 [Pagan Gazzard] </summary>

> ### open-balena-base-8.0.0 - 2019-07-08
> 
> * Upgrade to debian buster [Pagan Gazzard]
</details>

## 0.27.9 - 2019-07-02

* Avoid fetching deleted image installs for log write context [Pagan Gazzard]

## 0.27.8 - 2019-06-28

* Minor cleanup and typo fixes [Pagan Gazzard]

## 0.27.7 - 2019-06-25

* Block removal of the currently deployed release in isolation [Pagan Gazzard]

## 0.27.6 - 2019-06-24

* Add some indexes for delete cascading [Pagan Gazzard]

## 0.27.5 - 2019-06-21

* Fix unreturned promise warning in log-stream [Pagan Gazzard]

## 0.27.4 - 2019-06-21

* Add an index on the "image" table for use by a rule [Pagan Gazzard]

## 0.27.3 - 2019-06-21

* Merge release indexes to allow for better utilisation [Pagan Gazzard]

## 0.27.2 - 2019-06-20

* Drop duplicate api key index, it's already index via a unique index [Pagan Gazzard]

## 0.27.1 - 2019-06-20

* Update open-balena-base to 7.2.2 [Pagan Gazzard]

<details>
<summary> View details </summary>

### open-balena-base-7.2.2 - 2019-06-19

* systemd: move StartLimitIntervalSec to proper conf section [Matthew McGinn]
</details>

## 0.27.0 - 2019-06-19

* Use `addDeleteHookForDependents` for application deletes [Pagan Gazzard]
* Remove unnecessary sub dependent support - the deletes are run in order [Pagan Gazzard]

## 0.26.0 - 2019-06-17

* auth: allow device API keys to fully control the device's env vars [Gergely Imreh]

## 0.25.0 - 2019-06-14

* Cache the resolved subject for /auth/v1/token requests for 5 minutes [Pagan Gazzard]

## 0.24.8 - 2019-06-13

* Fix issue with undefined download progress [Pagan Gazzard]

## 0.24.7 - 2019-06-13

* Fix error when deleting all image installs in the patch endpoint [Pagan Gazzard]

## 0.24.6 - 2019-06-12

* Avoid unnecessary writes on the state patch endpoint [Pagan Gazzard]

## 0.24.5 - 2019-06-12

* Simplify and increase parallelisation of state patch endpoint [Pagan Gazzard]

## 0.24.4 - 2019-06-12

* Run state patch in a transaction [Pagan Gazzard]

## 0.24.3 - 2019-06-06

* Update open-balena-base to 7.2.1 [Pagan Gazzard]

<details>
<summary> View details </summary>

### open-balena-base-7.2.1 - 2019-06-03

* Fix adding htoprc [Pagan Gazzard]
</details>

## 0.24.2 - 2019-06-04

* Avoid unnecessary writes on login by adding an optional hook [Pagan Gazzard]

## 0.24.1 - 2019-06-04

* Update pinejs [Pagan Gazzard]

<details>
<summary> View details </summary>

### pinejs-10.15.4 - 2019-06-03

* Use `PromiseLike` to be more accepting with promise returning functions [Pagan Gazzard]

### pinejs-10.15.3 - 2019-06-03

* Update the alias instead of stripping for non-field nodes [Pagan Gazzard]

<details>
<summary> View details </summary>

#### odata-to-abstract-sql-3.2.0 - 2019-05-31

* Add support for computed fields [Pagan Gazzard]

#### odata-to-abstract-sql-3.1.3 - 2019-05-31

* Unify the handling of adding fields with or without a $select [Pagan Gazzard]

<details>
<summary> View details </summary>

##### odata-parser-1.0.4 - 2019-05-27

* Fix adding parameter alias to the options object [Pagan Gazzard]

##### odata-parser-1.0.3 - 2019-05-08

* Add .versionbot/CHANGELOG.yml for downstream changelogs [Pagan Gazzard]

##### abstract-sql-compiler-6.5.0 - 2019-05-30

* Add support for computed fields [Pagan Gazzard]

##### abstract-sql-compiler-6.4.3 - 2019-05-30

* Add tests for `getReferencedFields` [Pagan Gazzard]

##### abstract-sql-compiler-6.4.2 - 2019-05-09

* Update and fix lodash typings [Pagan Gazzard]
* Update husky/mocha dev dependencies [Pagan Gazzard]

##### abstract-sql-compiler-6.4.1 - 2019-05-08

* Fix typescript compilation [Pagan Gazzard]

<details>
<summary> View details </summary>

###### sbvr-parser-0.2.2 - 2019-05-08

* Add .versionbot/CHANGELOG.yml for downstream changelogs [Pagan Gazzard]
</details>

* Add node 12 tests [Pagan Gazzard]
* Add repo.yml for upstream changelogs [Pagan Gazzard]
* Add .versionbot/CHANGELOG.yml for downstream changelogs [Pagan Gazzard]
</details>


#### abstract-sql-compiler-6.6.0 - 2019-06-03

* Improve aliased from handling in `getReferencedFields` [Pagan Gazzard]

#### abstract-sql-compiler-6.5.1 - 2019-06-03

* Use an abstract-sql-optimiser prepass to simplify getReferencedFields [Pagan Gazzard]
</details>


### pinejs-10.15.2 - 2019-06-03

* Update lodash types [Pagan Gazzard]

### pinejs-10.15.1 - 2019-05-31

* Update dependencies [Pagan Gazzard]

<details>
<summary> View details </summary>

#### odata-parser-1.0.4 - 2019-05-27

* Fix adding parameter alias to the options object [Pagan Gazzard]

#### abstract-sql-compiler-6.5.0 - 2019-05-30

* Add support for computed fields [Pagan Gazzard]

#### abstract-sql-compiler-6.4.3 - 2019-05-30

* Add tests for `getReferencedFields` [Pagan Gazzard]
</details>

</details>

## 0.24.0 - 2019-06-03

* âœ¨ Add `host` flag to application type model [Andreas Fitzek]

## 0.23.1 - 2019-05-31

* Update dependencies [Pagan Gazzard]

<details>
<summary> View details </summary>

### pinejs-10.15.0 - 2019-05-21

* Add basic support for non-number fields in __metadata.uri [Pagan Gazzard]

### pinejs-10.14.3 - 2019-05-21

* Memoize `resolveNavigationResource` [Pagan Gazzard]

### pinejs-10.14.2 - 2019-05-21

* Fix `getMemoizedCompileRule` not correctly memoizing [Pagan Gazzard]

### pinejs-10.14.1 - 2019-05-20

* Remove unused functions [Pagan Gazzard]
</details>

## 0.23.0 - 2019-05-29

* Update open-balena-base to 7.2.0 [Pagan Gazzard]

<details>
<summary> View details </summary>

### open-balena-base-7.2.0 - 2019-05-29

* Add default htop settings to hide threads and use a tree view [Pagan Gazzard]

### open-balena-base-7.1.0 - 2019-05-29

* Update nodejs to 10.16.0 and npm to 6.9.0 [Pagan Gazzard]
</details>

## 0.22.5 - 2019-05-29

* Add an entry for the supervisor mixpanel controlling var [Cameron Diver]

## 0.22.4 - 2019-05-28

* Fix filtering out 'build' properties from services [Pagan Gazzard]

## 0.22.3 - 2019-05-28

* More device state simplification [Pagan Gazzard]

## 0.22.2 - 2019-05-27

* Fix `releaseFromApp` when the app has no commit associated [Pagan Gazzard]

## 0.22.1 - 2019-05-27

* Simplify device state query [Pagan Gazzard]

## 0.22.0 - 2019-05-27

* Use a prepared query for getting the release for an app [Pagan Gazzard]

## 0.21.0 - 2019-05-24

* Remove unused code [Pagan Gazzard]

## 0.20.7 - 2019-05-24

* Switch from `_` to `$` prefix for functions that are used [Pagan Gazzard]

## 0.20.6 - 2019-05-24

* Fix fetching `image_environment_variable` in the state endpoint [Pagan Gazzard]
* Fix overzealous conversion to native map [Pagan Gazzard]

## 0.20.5 - 2019-05-23

* Use native map in preference [Pagan Gazzard]
* Prefer native startsWith [Pagan Gazzard]
* Remove unnecessary uses of _.merge [Pagan Gazzard]
* Switch to native forEach [Pagan Gazzard]
* Use object spreads instead of _.assign [Pagan Gazzard]

## 0.20.4 - 2019-05-23

* Switch from `_.includes` to native `.includes` [Pagan Gazzard]

## 0.20.3 - 2019-05-22

* Avoid paying the cost of jwt auth if there's no chance of success [Pagan Gazzard]

## 0.20.2 - 2019-05-21

* Fix error when calling `checkDevicesCanHaveDeviceURL` with no devices [Pagan Gazzard]

## 0.20.1 - 2019-05-21

* Catch proxy request rejections to avoid excessive error reporting [Akis Kesoglou]

## 0.20.0 - 2019-05-20

* Only convert field to a path once [Pagan Gazzard]
* Merge `createRateLimit` and `createRateLimitMiddleware` [Pagan Gazzard]
* Simplify rate-limiting [Pagan Gazzard]

## 0.19.5 - 2019-05-20

* Update typed-error to 3.1.0 [Pagan Gazzard]

<details>
<summary> View details </summary>

### typed-error-3.1.0 - 2019-04-01

* dev: Enforce prettier coding standards [Will Boyce]
* npm: Update dependencies and remove `package-lock.json` [Will Boyce]
* codeowners: Add top contributors @wrboyce, @Page-, and @dfunckt [Will Boyce]
* versionbot: Add CHANGELOG.yml (for nested changelogs) [Will Boyce]

### typed-error-3.0.2 - 2018-11-01

* Update README with new import style [CameronDiver]

### typed-error-3.0.1 - 2018-10-29

* Update to typescript 3 [Pagan Gazzard]
* Update dev dependencies [Pagan Gazzard]
* Add node-10 to the circle test suite [Pagan Gazzard]

### typed-error-3.0.0 - 2018-04-17

* Distribute generated typescript declaration [Will Boyce]
* use circle for build/publish and add package-lock [Will Boyce]
* add lint scripts/requirements [Will Boyce]
* Remove `BaseError` class and  directly subclass `Error` [Will Boyce]
* Update dependencies, clean up package/tsconfig [Will Boyce]

### typed-error-2.0.1 - 2017-12-15

* Add LICENSE [Akis Kesoglou]
</details>

## 0.19.4 - 2019-05-20

* Some linting fixes for resin-lint 3 [Pagan Gazzard]

## 0.19.3 - 2019-05-17

* Silence expected API key related rejections [Akis Kesoglou]

## 0.19.2 - 2019-05-17

* Update dependencies [Pagan Gazzard]

## 0.19.1 - 2019-05-15

* Make use of a prepared query for device state query [Pagan Gazzard]
* Update pinejs to 10.14.0 [Pagan Gazzard]

<details>
<summary> View details </summary>

### pinejs-10.14.0 - 2019-05-15

* Update pinejs-client-core and make use of prepared queries [Pagan Gazzard]

<details>
<summary> View details </summary>

#### odata-parser-1.0.3 - 2019-05-08

* Add .versionbot/CHANGELOG.yml for downstream changelogs [Pagan Gazzard]

#### odata-parser-1.0.2 - 2019-04-15

* Update dependencies [Pagan Gazzard]

#### abstract-sql-compiler-6.4.2 - 2019-05-09

* Update and fix lodash typings [Pagan Gazzard]
* Update husky/mocha dev dependencies [Pagan Gazzard]

#### abstract-sql-compiler-6.4.1 - 2019-05-08

* Fix typescript compilation [Pagan Gazzard]

<details>
<summary> View details </summary>

##### sbvr-parser-0.2.2 - 2019-05-08

* Add .versionbot/CHANGELOG.yml for downstream changelogs [Pagan Gazzard]
</details>

* Add node 12 tests [Pagan Gazzard]
* Add repo.yml for upstream changelogs [Pagan Gazzard]
* Add .versionbot/CHANGELOG.yml for downstream changelogs [Pagan Gazzard]

#### pinejs-client-js-5.5.1 - 2019-05-15

* Fix downstream declaration creation errors due to `Dictionary` [Pagan Gazzard]

#### pinejs-client-js-5.5.0 - 2019-05-15

* Add a prepare method that prepares a query into a function [Pagan Gazzard]

#### pinejs-client-js-5.4.1 - 2019-05-10

* Add CODEOWNERS [Gergely Imreh]

#### pinejs-client-js-5.4.0 - 2019-05-10

* Add support for parameter aliases in resource ids [Pagan Gazzard]

#### pinejs-client-js-5.3.10 - 2019-05-10

* Deduplicate transformation of GET results [Pagan Gazzard]

#### pinejs-client-js-5.3.9 - 2019-05-10

* Simplify how we expose types, which means `subscribe` is now exposed [Pagan Gazzard]

#### pinejs-client-js-5.3.8 - 2019-05-09

* Add automatic formatting via prettier [Pagan Gazzard]

#### pinejs-client-js-5.3.7 - 2019-05-08

* Remove node 4 build, add node 12 [Pagan Gazzard]
* Add .versionbot/CHANGELOG.yml for downstream changelogs [Pagan Gazzard]

#### odata-to-abstract-sql-3.1.2 - 2019-05-08

* Add node 12 tests [Pagan Gazzard]
* Add repo.yml for upstream changelogs [Pagan Gazzard]
* Add .versionbot/CHANGELOG.yml for downstream changelogs [Pagan Gazzard]

#### sbvr-types-2.0.3 - 2019-05-08

* Add .versionbot/CHANGELOG.yml for downstream changelogs [Pagan Gazzard]

#### sbvr-parser-0.2.2 - 2019-05-08

* Add .versionbot/CHANGELOG.yml for downstream changelogs [Pagan Gazzard]
</details>


### pinejs-10.13.3 - 2019-05-14

* Fix possible null error when using a parameter alias with no value [Pagan Gazzard]

### pinejs-10.13.2 - 2019-05-08

* Add repo.yml for nested changelogs [Pagan Gazzard]

### pinejs-10.13.1 - 2019-05-06

* Add node 12 to the circle tests [Pagan Gazzard]

### pinejs-10.13.0 - 2019-05-06

* Expose odata-compiler as a bin script [Pagan Gazzard]

### pinejs-10.12.0 - 2019-05-01

* Expose sbvr-compiler as a bin script [Pagan Gazzard]
* Move odata-metadata-generator into odata-metadata directory [Pagan Gazzard]

### pinejs-10.11.3 - 2019-05-01

* Update @types/lodash, avoiding `_.isObject` where necessary [Pagan Gazzard]

### pinejs-10.11.2 - 2019-04-22

* Only validate the model if the query affected at least 1 row [Pagan Gazzard]

### pinejs-10.11.1 - 2019-04-11

* Switch odata-metadata-generator to using an abstract sql model [Pagan Gazzard]
</details>

## 0.19.0 - 2019-05-15

* Update target to es2018 [Pagan Gazzard]

## 0.18.6 - 2019-05-10

* bug: Resolve NPM dependency issues preventing startup [Rich Bayliss]

## 0.18.5 - 2019-05-08

* Add typed-error upstream to repo.yml [Pagan Gazzard]
* Add open-balena-base upstream to repo.yml [Pagan Gazzard]

## 0.18.4 - 2019-05-06

* Disable the service start limit [Pagan Gazzard]
* Update open-balena-base to v7.0.2 [Pagan Gazzard]

## 0.18.3 - 2019-05-01

* tests: Add test framework [Rich Bayliss]

## 0.18.2 - 2019-04-29

* Fix import ordering issue [Pagan Gazzard]

## 0.18.1 - 2019-04-29

* versionbot: add machine readable changelog [Gergely Imreh]

## 0.18.0 - 2019-04-29

* device-config: allow devices going back to v1.2.1 to use registry v2 [Gergely Imreh]

## 0.17.4 - 2019-04-26

* Handle requesting registry scopes with explicit indices above 20 [Pagan Gazzard]

## 0.17.3 - 2019-04-24

* Use more accurate `BadRequestError`s for invalid env var names [Pagan Gazzard]

## 0.17.2 - 2019-04-24

* os-config: disable client-initiated vpn tls key renegotiation [Will Boyce]

## 0.17.1 - 2019-04-19

* Remove unused `DEVICE_CONFIG_OPENVPN_CONFIG` fron env backend [Pagan Gazzard]

## 0.17.0 - 2019-04-18

* Rename `env_var_name` to `name` to match cloud [Pagan Gazzard]

## 0.16.1 - 2019-04-18

* fix: Changes required to make `my_application` resource available [Rich Bayliss]

## 0.16.0 - 2019-04-17

* Handle `my_applications` within pinejs [Pagan Gazzard]

## 0.15.2 - 2019-04-17

* device-proxy: use `.balena` tld in favour of `.resin` [Will Boyce]

## 0.15.1 - 2019-04-17

* Update method-override to 3.x [Pagan Gazzard]

## 0.15.0 - 2019-04-15

* Rename `configPath` to `config` and make sure config.json is valid [Pagan Gazzard]

<details>
<summary> View details </summary>

### pinejs-10.11.0 - 2019-04-11

* Allow specifying the abstract sql directly in the config [Pagan Gazzard]

### pinejs-10.10.0 - 2019-04-10

* Allow specifying absolute paths in the config [Pagan Gazzard]

### pinejs-10.9.0 - 2019-04-10

* Allow any importable config file type rather than just JSON [Pagan Gazzard]

### pinejs-10.8.2 - 2019-04-06

* Only print the error message on pool errors [Pagan Gazzard]

### pinejs-10.8.1 - 2019-04-01

* Add an error handler to the pg pool [Pagan Gazzard]
</details>

## 0.14.0 - 2019-04-04

* Whitelist the new RESIN_SUPERVISOR_INSTANT_UPDATE_TRIGGER configuration variable [Pablo Carranza Velez]

## 0.13.3 - 2019-04-02

* Fix `ResolvableReturnType` typing [Pagan Gazzard]

## 0.13.2 - 2019-04-01

* Add CODEOWNERS file [Pagan Gazzard]

## 0.13.1 - 2019-04-01

* Add an index for the vpn's service instance lookup [Pagan Gazzard]

## 0.13.0 - 2019-03-28

* Remove runInTransaction wrapper to avoid unnecessary function creation [Pagan Gazzard]
* Use a readTransaction for device state [Pagan Gazzard]

<details>
<summary> View details </summary>

### pinejs-10.8.0 - 2019-03-25

* Add support for read-only transactions for postgres/mysql backends [Pagan Gazzard]

### pinejs-10.7.0 - 2019-03-12

* Use definitions for all permission types [Pagan Gazzard]
</details>

## 0.12.0 - 2019-03-19

* Add build log to release resource [Stevche Radevski]

## 0.11.8 - 2019-03-12

* Add pinejs as upstream in repo.yml [Giovanni Garufi]

## 0.11.7 - 2019-03-11

* Update pinejs to 10.6.1 [Pagan Gazzard]

## 0.11.6 - 2019-03-08

* Avoid issues with updated bluebird typings [Pagan Gazzard]

## 0.11.5 - 2019-03-05

* Update open-balena-base to v5.3.1 [Pagan Gazzard]

## 0.11.4 - 2019-02-25

* Switch _ to $ due to the special meaning of _ in typescript [Pagan Gazzard]

## 0.11.3 - 2019-02-22

* Add connectivity-check endpoint that just sends a 204 [Pagan Gazzard]

## 0.11.2 - 2019-02-18

* Fix setting release to zero filtered devices 404 error [Thodoris Greasidis]

## 0.11.1 - 2019-02-14

* Added `skipHttpsPaths` to setup options [dt-rush]

## 0.11.0 - 2019-01-31

* Access: update variable name to remove previous company mention [Gergely Imreh]
* Access: lower host OS access to OS version 2.0.0 [Gergely Imreh]

## 0.10.2 - 2019-01-28

* Fix husky warning [Pagan Gazzard]

## 0.10.1 - 2019-01-28

* Add correct image location index migration [Pagan Gazzard]

## 0.10.0 - 2019-01-25

* Use a GIN trigram index for image_location to speed up endswith queries [Pagan Gazzard]

## 0.9.0 - 2019-01-16

* âœ¨ Add redis prefix for rate limiting [Andreas Fitzek]

## 0.8.1 - 2019-01-10

* Config: Embed device OpenVPN config [Heds Simons]

## 0.8.0 - 2019-01-09

* Add support for application, device and release tags [Akis Kesoglou]

## 0.7.4 - 2018-12-19

* Switch/update to fast-boot2 1.0.8 to avoid unnecessary existsSync calls [Pagan Gazzard]

## 0.7.3 - 2018-12-18

* Run Prettify over index.js [Akis Kesoglou]
* Add ability to reset the superuser password [Akis Kesoglou]

## 0.7.2 - 2018-12-12

* Hooks: Escalate permission to root when setting is_web_accessible [Rich Bayliss]

## 0.7.1 - 2018-12-11

* Permissions: Device API key should have read access to application_type [Rich Bayliss]

## 0.7.0 - 2018-12-07

* Update to pinejs 10 [Pagan Gazzard]

## 0.6.2 - 2018-12-03

* Update open-balena-base to v5.0.1 [Pagan Gazzard]

## 0.6.1 - 2018-11-28

* State: Send valid response to invalid devices polling the state endpoint [Rich Bayliss]

## 0.6.0 - 2018-11-19

* Bug: Remove dependency from release delete hook [Rich Bayliss]

## 0.5.4 - 2018-11-13

* Env-vars: Update persistent logging description [Thodoris Greasidis]

## 0.5.3 - 2018-11-12

* Fix resinCI npm tests by adding testing platforms [Thodoris Greasidis]
* Add a test script that builds and runs the linter on the sources [Thodoris Greasidis]

## 0.5.2 - 2018-11-09

* Device-types: Harden against S3 errors [Thodoris Greasidis]

## 0.5.1 - 2018-11-09

* Update package-lock.json [Pagan Gazzard]

## 0.5.0 - 2018-11-09

* Make config generation more generic [Akis Kesoglou]

## 0.4.0 - 2018-11-08

* Env-vars: Change descriptions for the balena rename [Thodoris Greasidis]

## 0.3.7 - 2018-11-07

* Auth: Create admin account on first run [Rich Bayliss]

## 0.3.6 - 2018-11-06

* Perms: Permit users permissions required to ssh into a device [Will Boyce]

## v0.3.5 - 2018-11-02

* Update to ts-node 7 [Pagan Gazzard]

## v0.3.4 - 2018-11-01

* Add missing VPN env vars [Akis Kesoglou]

## v0.3.3 - 2018-11-01

* Fix typo [Pagan Gazzard]

## v0.3.2 - 2018-11-01

* Reduce api queries used to update service installs by using $in [Pagan Gazzard]

## v0.3.1 - 2018-11-01

* Add precommit hook for linting [Pagan Gazzard]

## v0.3.0 - 2018-11-01

* Drop the pubnub backend [Pagan Gazzard]

## v0.2.0 - 2018-10-30

* Update to open-balena-base 5.0.0, including nodejs 10 [Pagan Gazzard]

## 0.1.4 - 2018-10-30

* Update resin-device-config to 5.x [Pagan Gazzard]

## v0.1.3 - 2018-10-29

* Expose API as v5 [Akis Kesoglou]

## v0.1.2 - 2018-10-26

* Add license to package.json [Akis Kesoglou]

## v0.1.1 - 2018-10-26

* Update dependencies [Akis Kesoglou]

## v0.1.0 - 2018-10-26

* Add the /config/var endpoint [Tim Perry]

## v0.0.2 - 2018-10-26

* Ensure project can be published as an NPM module [Akis Kesoglou]

## v0.0.1 - 2018-02-20

* Initial commit
